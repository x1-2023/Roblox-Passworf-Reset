(()=>{"use strict";const e={API_KEY:{key:"api_key",defaultValue:""},APP_ID:{key:"appId",defaultValue:""},POWER_ON:{key:"power_on",defaultValue:!0},TIKTOK:{key:"tiktok",defaultValue:{delayClick:500,delaySwipe:15,loop:!0,isActive:!0}},FUNCAPTCHA:{key:"funcaptcha",defaultValue:{delayClick:100,loop:!0,isActive:!0,maxImageCaptcha:25}},ZALO:{key:"zalo",defaultValue:{delayClick:100,loop:!0,isActive:!0}},SHOPEE:{key:"shopee",defaultValue:{delaySwipe:15,loop:!0,isActive:!0}},RECAPTCHAV2:{key:"reCaptchav2",defaultValue:{delayClick:500,loop:!0,isActive:!0,useToken:!1}},AMZN:{key:"amzn",defaultValue:{delayClick:100,loop:!0,isActive:!0}},GEETEST:{key:"geetest",defaultValue:{delayClick:500,delaySwipe:15,loop:!0,isActive:!0}},SLIDE_ALL:{key:"slide_all",defaultValue:{delaySwipe:15,loop:!0,isActive:!0}},HCAPTCHA:{key:"hcaptcha",defaultValue:{delayClick:500,delaySwipe:15,loop:!0,isActive:!0}},CLOUDFLARE:{key:"cloudflare",defaultValue:{delayClick:2e3,isActive:!0}}};async function t(e,t,o){const a="undefined"!=typeof browser?browser.runtime:chrome.runtime;try{return await new Promise(((r,l)=>{a.sendMessage({source:e,type:t,data:o},(e=>{a.lastError?l(new Error(`Error sending message: ${a.lastError.message}`)):r(e)}))}))}catch(e){throw console.error(`[messageHelpers] Error in sending message: ${e.message}`),e}}const o=async(e,t)=>{const o="undefined"!=typeof browser?browser.storage.local:chrome.storage.local,a="undefined"!=typeof browser?browser.runtime:chrome.runtime;try{const r=await o.get([e]);if(a.lastError)throw new Error(`Error retrieving ${e}: ${a.lastError.message}`);return null!=r[e]?r[e]:t}catch(t){throw console.error(`[storageHelpers] Error retrieving ${e}:`,t),t}};Promise.resolve();async function a(e){return new Promise((t=>setTimeout(t,e)))}let r,l;console.log("Run file discord-content",window.location.href);let s="",c=!1;async function i(){if(c)return;console.log("Running captchaImageToText");let e=null;for(let t=0;t<10&&(e=document.querySelector('[class*="imageWrapper"] a[href*="discordapp.com/ephemeral"]'),!e);t++)await a(1e3);if(!e)return;let o="";for(let r=0;r<10;r++){if(o=await t("IMAGETOTEXT","createImageBase64",{url:e.href}),o&&o!==s){s=o;break}await a(1e3)}if(!o)return;console.log("[discord] This is base64",o);const r=await async function(e){const o=JSON.stringify({clientKey:l,task:e});try{const e=await t("IMAGETOTEXT","createTask",o);return e||(console.error("[imagetotext] No taskId returned from createTask"),"")}catch(e){return console.error("[imagetotext] Failed to create task:",e),""}}({type:"ImageToTextTask",imageBase64:o});if(!r)return;const i=await async function(e,o){const a=JSON.stringify({clientKey:l,taskId:e});try{const e=await t("IMAGETOTEXT","getTaskResult",{data:a,timeWait:o});return e?"fail"===e.status?(console.error("[imagetotext] API error:",e),null):e.solution?e.solution:(console.error("[imagetotext] Invalid API response: missing solution"),null):(console.error("[imagetotext] No result returned from getTaskResult"),null)}catch(e){return console.error("[imagetotext] Failed to get task result:",e),null}}(r,20);if(!i)return;document.querySelectorAll('[id*="message-accessories"] [class*="children"] button[role="button"]').forEach((e=>{const t=e.querySelector('div[class*="label"]');t&&"next"===t.textContent.trim().toLowerCase()&&e.click()})),await a(2e3);const n=document.querySelector('[class*="fieldWrapper"] [class*="wrapper"] input[class*="input"]');if(!n)return;n.value=i.text,n.dispatchEvent(new Event("input",{bubbles:!0})),await a(500),document.querySelector('footer[class*="actionBar"] button[role="button"]:nth-of-type(2) [class*="buttonChildrenWrapper"] [class*="buttonChildren"]').click(),await a(2500);document.querySelector('[id*="message-content"] [class*="emojiContainer"] img[data-name=":x:"]')?location.reload():(c=!0,console.log("[discord] Captcha solved successfully, stop solving."))}(async()=>{await async function(){r=await o(e.POWER_ON.key,e.POWER_ON.defaultValue),l=await o(e.API_KEY.key,e.API_KEY.defaultValue)}(),await async function(){if(r&&l&&"YOUR_CLIEN_KEY"!==l){for(let e=0;e<30;e++){console.log("[discord] Tìm nút verify...");const t=document.querySelectorAll('[id*="message-accessories"] [class*="children"] button[role="button"]');if(Array.from(t).some((e=>{const t=e.querySelector('div[class*="label"]');return!(!t||"verify"!==t.textContent.trim().toLowerCase()||(e.click(),0))})))break;if(29===e)return void console.log("[discord] Thoát hàm findAndSolveCaptcha");await a(1e3)}console.log("[discord] Bắt đầu quét tìm captcha...");for(let e=0;e<20;e++){if(c){console.log("[discord] Captcha đã được giải, dừng quét.");break}if(document.querySelector('[class*="imageWrapper"] a[href*="discordapp.com/ephemeral"]')){console.log(`[discord] Tìm thấy ảnh captcha ở lần thử thứ ${e+1}. Bắt đầu giải...`);try{await i()}catch(e){console.error("[discord] Lỗi khi đang giải captcha:",e)}break}console.log(`[discord] Lần thử ${e+1}/20: Không tìm thấy captcha. Đang chờ...`),await a(1e3)}console.log("[discord] Kết thúc quá trình quét tìm captcha.")}else console.log("[discord] Đang tắt")}()})()})();