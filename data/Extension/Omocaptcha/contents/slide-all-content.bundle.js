(()=>{"use strict";const e={API_KEY:{key:"api_key",defaultValue:""},APP_ID:{key:"appId",defaultValue:""},POWER_ON:{key:"power_on",defaultValue:!0},TIKTOK:{key:"tiktok",defaultValue:{delayClick:500,delaySwipe:15,loop:!0,isActive:!0}},FUNCAPTCHA:{key:"funcaptcha",defaultValue:{delayClick:100,loop:!0,isActive:!0,maxImageCaptcha:25}},ZALO:{key:"zalo",defaultValue:{delayClick:100,loop:!0,isActive:!0}},SHOPEE:{key:"shopee",defaultValue:{delaySwipe:15,loop:!0,isActive:!0}},RECAPTCHAV2:{key:"reCaptchav2",defaultValue:{delayClick:500,loop:!0,isActive:!0,useToken:!1}},AMZN:{key:"amzn",defaultValue:{delayClick:100,loop:!0,isActive:!0}},GEETEST:{key:"geetest",defaultValue:{delayClick:500,delaySwipe:15,loop:!0,isActive:!0}},SLIDE_ALL:{key:"slide_all",defaultValue:{delaySwipe:15,loop:!0,isActive:!0}},HCAPTCHA:{key:"hcaptcha",defaultValue:{delayClick:500,delaySwipe:15,loop:!0,isActive:!0}},CLOUDFLARE:{key:"cloudflare",defaultValue:{delayClick:2e3,isActive:!0}}};async function t(e,t,o){const n="undefined"!=typeof browser?browser.runtime:chrome.runtime;try{return await new Promise(((a,l)=>{n.sendMessage({source:e,type:t,data:o},(e=>{n.lastError?l(new Error(`Error sending message: ${n.lastError.message}`)):a(e)}))}))}catch(e){throw console.error(`[messageHelpers] Error in sending message: ${e.message}`),e}}const o=async(e,t)=>{const o="undefined"!=typeof browser?browser.storage.local:chrome.storage.local,n="undefined"!=typeof browser?browser.runtime:chrome.runtime;try{const a=await o.get([e]);if(n.lastError)throw new Error(`Error retrieving ${e}: ${n.lastError.message}`);return null!=a[e]?a[e]:t}catch(t){throw console.error(`[storageHelpers] Error retrieving ${e}:`,t),t}};Promise.resolve();async function n(e){return new Promise((t=>setTimeout(t,e)))}async function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{timeout:5e3,maxRetries:3};try{const{timeout:o,maxRetries:a}=t,l={arkoselabs:"image/jpeg"};function i(e){for(const[t,o]of Object.entries(l))if(e.includes(t))return o;return"image/png"}if(e instanceof HTMLCanvasElement||e.tagName&&"CANVAS"===e.tagName.toUpperCase())try{if(0===e.width||0===e.height)return console.log("Canvas rỗng hoặc không có kích thước"),"";const c=e.getBoundingClientRect(),s=c.width,r=c.height,u=document.createElement("canvas");u.width=s,u.height=r;u.getContext("2d").drawImage(e,0,0,s,r);const d="image/png",h=u.toDataURL(d).split(",")[1];return h||(console.log("Không thể lấy base64 từ canvas"),"")}catch(m){return console.log("Lỗi khi chụp màn hình canvas:",m),""}if(e instanceof Element)try{const g=e.src;if(g&&g.startsWith("data:image/")){const f=g.split(",")[1];return f||(console.log("Base64 rỗng từ src của element"),"")}e=g||""}catch(p){return console.log("Lỗi khi xử lý element:",p),""}if("string"==typeof e&&e.startsWith("blob:")){console.log("Da vao blob");try{return await new Promise((t=>{const o=new Image;o.setAttribute("crossOrigin","anonymous");const n=setTimeout((()=>{t("")}),1e3);o.onload=function(){console.log("Vao trong onload"),clearTimeout(n);try{const o=document.createElement("canvas");o.width=this.naturalWidth,o.height=this.naturalHeight;o.getContext("2d").drawImage(this,0,0);const n=i(e);o.toBlob((e=>{if(!e)return void t("");const o=new FileReader;o.onloadend=()=>{const e=o.result.split(",")[1];t(e)},o.onerror=()=>t(""),o.readAsDataURL(e)}),n)}catch(e){console.log("Lỗi khi xử lý blob URL:",e),t("")}},o.onerror=()=>{clearTimeout(n),t("")},o.src=e,console.log("This is img:"),console.log("img src:",o.src)}))}catch(w){return console.log("Lỗi khi xử lý blob URL:",w),""}}if("string"==typeof e){console.log("Vao den input string:");try{for(let y=0;y<a;y++)try{const b=new AbortController,v=setTimeout((()=>b.abort()),o),k=await fetch(e,{signal:b.signal});if(clearTimeout(v),!k.ok)throw new Error(`HTTP error ${k.status}`);const S=await k.blob();return await new Promise(((e,t)=>{const o=new FileReader;o.onloadend=()=>e(o.result.split(",")[1]),o.onerror=()=>t(new Error("Failed to read blob as base64")),o.readAsDataURL(S)}))}catch(E){if(y===a-1)return console.log("Hết lượt thử fetch:",E),"";await n(500)}}catch(A){return console.log("Lỗi khi fetch URL:",A),""}}return console.log("Đầu vào không được hỗ trợ:",e),""}catch(T){return console.log("Lỗi chung trong fetchImageToBase64:",T),""}}function l(e,t){return new Promise((o=>{const n=Date.now(),a=setInterval((()=>{for(const t of e){if(document.querySelector(t))return clearInterval(a),void o(!0)}Date.now()-n>=t&&(clearInterval(a),o(!1))}),500)}))}function i(e,t){return new Promise((o=>{const n=document.querySelector(e);if(n)return o(n);const a=new MutationObserver(((t,n)=>{const a=document.querySelector(e);a&&(n.disconnect(),o(a))}));a.observe(document.body,{childList:!0,subtree:!0}),setTimeout((()=>{a.disconnect(),o(null)}),t)}))}let c,s,r,u,d;async function h(){c=await o(e.POWER_ON.key,e.POWER_ON.defaultValue),s=await o(e.API_KEY.key,e.API_KEY.defaultValue);const t=await o(e.SLIDE_ALL.key,e.SLIDE_ALL.defaultValue);r=t.delaySwipe,u=t.loop,d=t.isActive}console.log("Run file SlideAll");let m=!1,g="";async function f(){for(console.log("[SlideAll] This is captchaKeoThaCoresky");;){let e,t;await n(500);for(let o=0;o<10&&(e=document.querySelector('[class*="mask"][style=""] [class*="verify-img-panel"] img'),t=document.querySelector('[class*="mask"][style=""] [class*="verify-sub-block"] img'),null===e||null===t);o++)await n(1e3);if(!e||!t)return;const o={type:"SliderAllWebTask",domain:"www.coresky.com",imageBase64s:[e.src.split(",")[1],t.src.split(",")[1]]},a=await T(o);if(!a){if(u){document.querySelector(".verify-refresh").click();continue}return}const l=await _(a,30);if(console.log("[SlideAll] result:",l),!l){if(u){document.querySelector(".verify-refresh").click();continue}return}let i=parseInt(l.end,10);console.log("conutX:",i);let c=document.querySelector(".verify-move-block");if(!c)continue;const s=c.getBoundingClientRect(),r=s.left+s.width/2,d=s.top+s.height/2,h=r+i;c.dispatchEvent(new MouseEvent("mousedown",{bubbles:!0,cancelable:!0,clientX:r,clientY:d}));const m=20;for(let e=1;e<=m;e++){const t=r+i*e/m;c.dispatchEvent(new MouseEvent("mousemove",{bubbles:!0,cancelable:!0,clientX:t,clientY:d})),await n(20)}if(c.dispatchEvent(new MouseEvent("mouseup",{bubbles:!0,cancelable:!0,clientX:h,clientY:d})),console.log(`[SlideAll] Đã kéo button sang phải ${i}px`),!u)return;await n(5e3),document.querySelector(".verify-refresh").click()}}async function p(){for(console.log("This is captchaGarena::");;){await n(700);var e=null;for(let t=0;t<10&&null==(e=document.querySelector('[id="captcha__element"] [id="captcha__puzzle"]>canvas'));t++)await n(1e3);if(!e)return;let t="";for(let e=0;e<10;e++){if(t=S(),t&&g!==t){g=t;break}await n(1e3)}if(!t)return;console.log("[SlideAll] This is imgBase64>>>",t);const o={type:"SliderAllWebTask",imageBase64:t,widthView:e.width,heightView:e.height},a=await T(o);if(!a){if(console.log("[SlideAll] Ko có taskId"),u){document.querySelector('button[id="captcha__reload__button"]').click();continue}return}const l=await _(a,30);if(console.log("[SlideAll] This is result>>>",l),!l){if(console.log("[SlideAll] Ko có result"),u){document.querySelector('button[id="captcha__reload__button"]').click();continue}return}let c=parseInt(l.rects[0].x,10)+12,s=document.querySelector('[id="captcha__frame__bottom"] [class*="sliderContainer"] div[class="slider"]');if(await A(s,c),u){if(await i('[class*="captcha_lock_success"]',5e3)){console.log("Giải captcha thành công");break}console.log("Giải captcha xong")}}}async function w(){for(console.log("[SlideAll] This is captchaKeoThaKwai");;){let e,t;await n(500);for(let o=0;o<10&&(e=document.querySelector('[class*="kwai-captcha-page"] [class*="image-container"] img[class="bg-img"]'),t=document.querySelector('[class*="kwai-captcha-page"] [class*="image-container"] img[class="slider-img"]'),null===e||null===t);o++)await n(1e3);if(!e||!t)return;const o={type:"SliderAllWebTask",imageBase64:await a(e.src),widthView:e.width,heightView:e.height},l=await T(o);if(!l){if(u){document.querySelector(".icon.icon-refresh").click();continue}return}const i=await _(l,30);if(console.log("[SlideAll] result:",i),!i){if(u){document.querySelector(".icon.icon-refresh").click();continue}return}let c=parseInt(i.rects[0].x,10)-t.offsetLeft;console.log("conutX:",c);let s=document.querySelector(".slider .slider-shadow > div");await A(s,c)}}async function y(){for(console.log("[SlideAll] This is captchaKeoThaCoinMarketCap");;){let e,o;await n(500);for(let t=0;t<10&&(e=document.querySelector('[class*="bs-popup"] [class*="bs-main-image"]'),o=document.querySelector(".bs-slide-image"),null===e);t++)await n(1e3);if(!e)return;const a=getComputedStyle(e),l=a.backgroundImage.match(/url\(["']?(.*?)["']?\)/)?.[1];console.log("bgUrl",l);let i="";for(let e=0;e<10;e++){if(i=await t("SLIDE_ALL","createImageBase64",{url:l}),i&&g!==i){g=i;break}await n(1e3)}console.log("[SlideAll] This is backgroundBase64",i),console.log("[SlideAll] This is width imgPuzzle",o.clientWidth);const c={type:"SliderAllWebTask",imageBase64:i,widthView:e.clientWidth+o.clientWidth,heightView:e.clientHeight},s=await T(c);if(!s){if(u){document.querySelector(".bs-refresh-icon").click();continue}return}const r=await _(s,30);if(console.log("[SlideAll] result:",r),!r){if(u){document.querySelector(".bs-refresh-icon").click();continue}return}let d=parseInt(r.rects[1].x,10)-o.clientWidth;console.log("conutX:",d);let h=document.querySelector(".bs-slide-thumb");await A(h,d)}}async function b(){for(console.log("[SlideAll] This is captchaKeoTha_pixelheroes");;){let e;await n(500);for(let t=0;t<10&&(e=document.querySelector('img[class*="gocaptcha-module_picture"]'),null===e);t++)await n(1e3);if(!e)return;let t="";for(let o=0;o<10;o++){if(t=e.src,t&&g!==t){g=t;break}await n(1e3)}console.log("[SlideAll] This is backgroundBase64",t),console.log("[SlideAll] This is imgBackground clientWidth",e.clientWidth);const o={type:"SliderAllWebTask",imageBase64:t,widthView:e.clientWidth,heightView:e.clientHeight};let a=document.querySelector('[class*="gocaptcha-module_dragBlock"]');const l=await T(o);if(!l){if(u){location.reload();continue}return}const i=await _(l,30);if(console.log("[SlideAll] result:",i),!i){if(u){location.reload();continue}return}let c=parseInt(i.rects[0].x,10),s=1;console.log("conutX:",c),s=103===c?91:112===c?99:205===c?182:215===c?195:c-15,await E(a,s),await n(3e3);document.querySelector('img[class*="gocaptcha-module_picture"]')&&location.reload()}}async function v(){for(console.log("[SlideAll] This is captcha_titannet");;){let e;await n(500);for(let t=0;t<10&&(e=document.querySelector('#aliyunCaptcha-window-popup[style*="display: block;"] #aliyunCaptcha-img'),null===e);t++)await n(1e3);if(!e)return;let t="";for(let o=0;o<10;o++){if(o>0&&await n(1e3),t=await a(e.src),t&&g!==t){g=t;break}await n(1e3)}return console.log("[SlideAll] This is backgroundBase64",t),void console.log("[SlideAll] This is imgBackground clientWidth",e.clientWidth)}}function k(e){return!!document.querySelector(e)}function S(){const e=document.querySelectorAll("#captcha__puzzle canvas"),t=e[0],o=e[1],n=document.createElement("canvas");n.width=280,n.height=155;const a=n.getContext("2d");a.drawImage(t,0,0),a.drawImage(o,0,0);const l=n.toDataURL("image/jpeg"),i=l.replace(/^data:image\/jpeg;base64,/,"");return console.log("Base64 đầy đủ:\n",l),console.log("Base64 chỉ phần mã hóa:\n",i),i}async function E(e,t){return new Promise((o=>{if(!e)return o();e.parentElement;const a=t,l=new DataTransfer,i=r;function c(t){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.dispatchEvent(new MouseEvent(t,{bubbles:!0,cancelable:!0,...o})),e.dispatchEvent(new PointerEvent(t,{bubbles:!0,cancelable:!0,...o,pointerType:"mouse",isPrimary:!0}))}(async()=>{c("mouseenter"),c("mouseover"),await n(i),c("pointerdown",{clientX:0,clientY:0}),c("mousedown",{clientX:0,clientY:0}),e.dispatchEvent(new DragEvent("dragstart",{bubbles:!0,cancelable:!0,dataTransfer:l}));let s=0,r=0;for(;s+10<t;){const e=s/t;let o;o=e<.3?2*Math.random()+1:e<.7?6*Math.random()+2:2*Math.random()+.5,s+=o,r+=8*(Math.random()-.5);const l=Math.min(s,a),u=r;c("mousemove",{clientX:l,clientY:u}),c("pointermove",{clientX:l,clientY:u}),await n(i)}s=t;const u=r;c("mousemove",{clientX:s,clientY:u}),c("pointermove",{clientX:s,clientY:u}),await n(i),c("pointerup",{clientX:s,clientY:u}),c("mouseup",{clientX:s,clientY:u}),e.dispatchEvent(new DragEvent("dragend",{bubbles:!0,cancelable:!0,dataTransfer:l})),console.log("Vị trí backend >>>",t),console.log(`Vị trí cuối cùng của element: x = ${s}, y = ${u}`),o()})()}))}async function A(e,t){const o=e.getBoundingClientRect(),n=o.left+o.width/2,a=o.top+o.height/2,l=n+t,i={bubbles:!0,cancelable:!0,clientX:n,clientY:a,pointerType:"mouse",buttons:0};for(const t of[e,document,window])t.dispatchEvent(new PointerEvent("pointerover",i)),t.dispatchEvent(new PointerEvent("pointerenter",i)),t.dispatchEvent(new MouseEvent("mouseover",i)),t.dispatchEvent(new MouseEvent("mouseenter",i));await new Promise((e=>setTimeout(e,300)));const c={...i,buttons:1};for(const t of[e,document,window])t.dispatchEvent(new PointerEvent("pointerdown",c)),t.dispatchEvent(new MouseEvent("mousedown",c));const s=12+Math.floor(6*Math.random());for(let o=0;o<=s;o++){const l={bubbles:!0,cancelable:!0,clientX:n+t*(o/s)+2*(Math.random()-.5),clientY:a+3*(Math.random()-.5),pointerType:"mouse",buttons:1};for(const t of[e,document,window])t.dispatchEvent(new PointerEvent("pointermove",l)),t.dispatchEvent(new MouseEvent("mousemove",l));await new Promise((e=>setTimeout(e,35+25*Math.random())))}const r={bubbles:!0,cancelable:!0,clientX:l,clientY:a,pointerType:"mouse",buttons:0};for(const t of[e,document,window])t.dispatchEvent(new PointerEvent("pointerup",r)),t.dispatchEvent(new MouseEvent("mouseup",r));console.log(`[TEST] Đã kéo ${t}px từ (${n}, ${a})`)}async function T(e){const o=JSON.stringify({clientKey:s,task:e});try{const e=await t("GEETEST","createTask",o);return e||(console.error("[SlideAll] No taskId returned from createTask"),"")}catch(e){return console.error("[SlideAll] Failed to create task:",e),""}}async function _(e,o){const n=JSON.stringify({clientKey:s,taskId:e});try{const e=await t("GEETEST","getTaskResult",{data:n,timeWait:o});return e?"fail"===e.status?(console.error("[SlideAll] API error:",e),null):e.solution?e.solution:(console.error("[SlideAll] Invalid API response: missing solution"),null):(console.error("[SlideAll] No result returned from getTaskResult"),null)}catch(e){return console.error("[SlideAll] Failed to get task result:",e),null}}(async()=>{await h();new MutationObserver((async(e,t)=>{await async function(e){if(console.log("Đã vào [SlideAll] handleElementMutation"),await h(),c&&d&&s&&"YOUR_CLIEN_KEY"!==s)for(const t of e)if("childList"===t.type){const e=document.querySelector('[class*="kwai-captcha-page"] [class*="image-container"]'),t=document.querySelector('[class*="bs-popup"] [class*="bs-main-image"]');if(!e&&!t||m)continue;if(console.log("[SlideAll] Da thay target Element"),!s)return;m=!0;try{if(await n(1500),!await l(['[class*="kwai-captcha-page"] [class*="image-container"] img','[class*="bs-popup"] [class*="bs-main-image"]'],1e4))return;console.log("[SlideAll] Tìm thấy elementExists");for(let e=0;e<20;e++){if(k('[class*="kwai-captcha-page"] [class*="image-container"] img[class="bg-img"]')){await w();break}if(k('[class*="bs-popup"] [class*="bs-main-image"]')){await y();break}await n(1e3)}}finally{m=!1}}}(e)})).observe(document.body,{childList:!0,subtree:!0});const e={"www.coresky.com":{captchaImageSelector:'[class*="mask"][style=""] [class*="verify-img-panel"] img',function:f},"dapp.pixelheroes.io":{captchaImageSelector:'img[class*="gocaptcha-module_picture"]',function:b},"edge.titannet.info":{captchaImageSelector:'#aliyunCaptcha-window-popup[style*="display: block;"] #aliyunCaptcha-img',function:v},"geo.captcha-delivery.com":{captchaImageSelector:'[id="captcha__element"] [id="captcha__puzzle"] canvas[class="block"]',function:p}},t=window.location.hostname,o=e[t];if(console.log("This is hostname:",t),o){let a=!1;async function i(e){if(c&&d&&s&&"YOUR_CLIEN_KEY"!==s&&!a){a=!0,console.log("[SlideAll] Phát hiện captcha, bắt đầu xử lý...");try{await o.function()}catch(e){console.error("[SlideAll] Lỗi xử lý captcha:",e)}finally{a=!1}}}(async()=>{for(let e=0;e<100;e++){const e=document.querySelector(o.captchaImageSelector);if(e){await i();break}await n(1500)}})();new MutationObserver((()=>{const e=document.querySelector(o.captchaImageSelector);e&&i()})).observe(document.body,{childList:!0,subtree:!0})}else console.log("[SlideAll] Không có config cho trang:",t)})()})();